import { useState, useRef, useEffect } from 'react';
import { motion } from 'motion/react';
import { Volume2, VolumeX } from 'lucide-react';
import svgPaths from "../../imports/svg-2rgimnw3la";
import img0J4A5782 from "figma:asset/6563420ec2f7e583faaeeecc11799ece96b1fb95.png";
import imgImage35 from "figma:asset/32389039c068e804fd710d39e747a9adba7c0a24.png";
import img1003194538 from "figma:asset/1742d8059b28151d4de31489569a7beabfa8730c.png";
import img1003194535 from "figma:asset/a5b77e2818ec988a48ca02b106f131f56b395a9a.png";
import img1000061762 from "figma:asset/1742d8059b28151d4de31489569a7beabfa8730c.png";
import imgKiddiesMagazineCoverPageMay3 from "figma:asset/0a8506d7a4858d807d480735680d60420b944f40.png";
import img1000893181 from "../../assets/1742d8059b28151d4de31489569a7beabfa8730c.png";
import imgImage4 from "../../assets/1742d8059b28151d4de31489569a7beabfa8730c.png";
import imgH3A2447 from "../../assets/a5b77e2818ec988a48ca02b106f131f56b395a9a.png";
import imgNewFrame from "../../assets/3e53b923fe681dafd828b1ec28769be5e02ee7d2.png";
import imgImage5 from "figma:asset/c3fcf8bf8f17a9d9b4248889deffbdf66d9fc330.png";
import imgBg from "figma:asset/caa16e8d8a0e15a5b25985e4bb467e1dc0ed6349.png";
import imgImage34 from "figma:asset/54c57a7128b8456203a2a1e1fc6215e485494d85.png";
import { img1003194537 } from "../../imports/svg-divku";
import narrationAudio from '../../assets/P9.mp3';

function ImgGroup() {
  return (
    <div className="absolute h-[598px] left-[836px] top-[1700px] w-[743px]" data-name="IMG Group">
      <div className="h-[598px] overflow-clip relative rounded-[inherit] w-[743px]">
        <motion.div 
          className="absolute h-[829px] left-[calc(50%+10px)] top-[calc(50%-16.5px)] translate-x-[-50%] translate-y-[-50%] w-[815px]" 
          data-name="0J4A5782"
          initial={{ scale: 1 }}
          animate={{ scale: [1, 1.05, 1] }}
          transition={{ duration: 4, repeat: Infinity, ease: "easeInOut" }}
        >
          <div className="absolute inset-0 overflow-hidden pointer-events-none">
            <img alt="Child holding Healing to the Nations Magazine" className="absolute h-[134.8%] left-0 max-w-none top-[-4.12%] w-full" src={img0J4A5782} />
          </div>
        </motion.div>
      </div>
      <div aria-hidden="true" className="absolute border-8 border-solid border-white inset-0 pointer-events-none" />
    </div>
  );
}

function HighlightContent() {
  return (
    <div className="absolute bg-[#f6fae9] box-border content-stretch flex flex-col gap-[10px] h-[598px] items-center justify-center left-[176px] p-[80px] rounded-[112px] shadow-[0px_28px_64.5px_0px_rgba(0,0,0,0.25)] top-[1700px] w-[600px]" data-name="Highlight content">
      <motion.div 
        className="h-[510.5px] relative shrink-0 w-[518px]" 
        data-name="image 35"
        initial={{ rotate: 0 }}
        animate={{ rotate: [-2, 2, -2, 2, 0] }}
        transition={{ duration: 0.8, repeat: Infinity, repeatDelay: 2, ease: "easeInOut" }}
      >
        <img alt="Join the Kidspiration adventure to help give every child divine health in Christ!" className="absolute inset-0 max-w-none object-50%-50% object-cover pointer-events-none size-full" src={imgImage35} />
      </motion.div>
    </div>
  );
}

function Footer() {
  return (
    <div className="absolute left-0 size-[0.01px] top-0" data-name="Footer">
      <ImgGroup />
      <HighlightContent />
    </div>
  );
}

function ClippingRectangle2Copy() {
  return (
    <div className="absolute left-0 size-[0.01px] top-0" data-name="Clipping - Rectangle 2 copy 3">
      <div className="absolute h-[421.973px] left-[151px] top-[1198.01px] w-[1446px]" data-name="Rectangle 2 copy 3">
        <svg className="block size-full" fill="none" preserveAspectRatio="none" viewBox="0 0 32 32">
          <g id="Rectangle 2 copy 3"></g>
        </svg>
      </div>
      <div className="absolute h-[1772px] left-[-123px] mask-alpha mask-intersect mask-no-clip mask-no-repeat mask-position-[274px_144.013px] mask-size-[1446px_421.973px] top-[1054px] w-[997px]" data-name="1003194537" style={{ maskImage: `url('${img1003194537}')` }}>
        <motion.img 
          alt="Children with magazines" 
          className="absolute inset-0 max-w-none object-50%-50% object-contain pointer-events-none size-full" 
          src={img1003194538}
          initial={{ scale: 1 }}
          animate={{ scale: [1, 1.03, 1] }}
          transition={{ duration: 5, repeat: Infinity, ease: "easeInOut" }}
        />
      </div>
      <div className="absolute h-[572px] left-[1171px] mask-alpha mask-intersect mask-no-clip mask-no-repeat mask-position-[-1020px_1.013px] mask-size-[1446px_421.973px] top-[1197px] w-[429px]" data-name="1003194535" style={{ maskImage: `url('${img1003194537}')` }}>
        <motion.img 
          alt="Children with magazines" 
          className="absolute inset-0 max-w-none object-50%-50% object-contain pointer-events-none size-full" 
          src={img1003194535}
          initial={{ scale: 1 }}
          animate={{ scale: [1, 1.03, 1] }}
          transition={{ duration: 5.5, repeat: Infinity, ease: "easeInOut", delay: 0.5 }}
        />
      </div>
      <div className="absolute h-[589px] left-[729px] mask-alpha mask-intersect mask-no-clip mask-no-repeat mask-position-[-578px_15.013px] mask-size-[1446px_421.973px] top-[1183px] w-[442px]" data-name="1000061762" style={{ maskImage: `url('${img1003194537}')` }}>
        <motion.img 
          alt="Child with magazine" 
          className="absolute inset-0 max-w-none object-50%-50% object-contain pointer-events-none size-full" 
          src={img1000061762}
          initial={{ scale: 1 }}
          animate={{ scale: [1, 1.03, 1] }}
          transition={{ duration: 4.5, repeat: Infinity, ease: "easeInOut", delay: 0.2 }}
        />
      </div>
      <div className="absolute h-[327px] left-[774px] mask-alpha mask-intersect mask-no-clip mask-no-repeat mask-position-[-623px_-206.987px] mask-size-[1446px_421.973px] top-[1405px] w-[284px]" data-name="Kiddies Magazine Cover Page - MAY 3" style={{ maskImage: `url('${img1003194537}')` }}>
        <img alt="Kiddies Magazine Cover" className="absolute inset-0 max-w-none object-50%-50% object-contain pointer-events-none size-full" src={imgKiddiesMagazineCoverPageMay3} />
      </div>
      <div className="absolute h-[459px] left-[1169px] mask-alpha mask-intersect mask-no-clip mask-no-repeat mask-position-[-1018px_16.013px] mask-size-[1446px_421.973px] top-[1182px] w-[13px]" style={{ maskImage: `url('${img1003194537}')` }}>
        <svg className="block size-full" fill="none" preserveAspectRatio="none" viewBox="0 0 13 459">
          <path clipRule="evenodd" d={svgPaths.p36245600} fill="var(--fill-0, white)" fillRule="evenodd" id="Rectangle 4" />
        </svg>
      </div>
      <div className="absolute h-[459px] left-[723px] mask-alpha mask-intersect mask-no-clip mask-no-repeat mask-position-[-572px_16.013px] mask-size-[1446px_421.973px] top-[1182px] w-[13px]" data-name="Rectangle 4 copy" style={{ maskImage: `url('${img1003194537}')` }}>
        <svg className="block size-full" fill="none" preserveAspectRatio="none" viewBox="0 0 13 459">
          <path clipRule="evenodd" d={svgPaths.p1a8c4f00} fill="var(--fill-0, white)" fillRule="evenodd" id="Rectangle 4 copy" />
        </svg>
      </div>
    </div>
  );
}

function ImgGroup1() {
  return (
    <div className="absolute left-0 size-[0.01px] top-0" data-name="IMG Group">
      <ClippingRectangle2Copy />
    </div>
  );
}

function ImgGroup2() {
  return (
    <div className="absolute content-stretch flex flex-col gap-[10px] items-start left-0 top-0 w-[0.01px]" data-name="IMG Group">
      <div className="h-[816px] relative shrink-0 w-full" data-name="1000893181">
        <motion.img 
          alt="Group of children holding Healing to the Nations magazines" 
          className="absolute inset-0 max-w-none object-50%-50% object-contain pointer-events-none size-full" 
          src={img1000893181}
          initial={{ scale: 1 }}
          animate={{ scale: [1, 1.04, 1] }}
          transition={{ duration: 6, repeat: Infinity, ease: "easeInOut" }}
        />
      </div>
    </div>
  );
}

function Frame() {
  return (
    <div className="basis-0 grow h-[445px] min-h-px min-w-px overflow-clip relative shrink-0">
      <motion.div 
        className="absolute h-[755px] left-[-143px] top-[-68px] w-[1133px]" 
        data-name="image 4"
        initial={{ scale: 1 }}
        animate={{ scale: [1, 1.05, 1] }}
        transition={{ duration: 5, repeat: Infinity, ease: "easeInOut", delay: 0.3 }}
      >
        <img alt="Healing Streams event" className="absolute inset-0 max-w-none object-50%-50% object-cover pointer-events-none size-full" src={imgImage4} />
      </motion.div>
    </div>
  );
}

function FrameNew() {
  return (
    <div className="basis-0 grow h-[445px] min-h-px min-w-px overflow-hidden relative shrink-0">
      <motion.div
        className="absolute h-[755px] left-[-143px] top-[-68px] w-[1133px]" 
        data-name="image new"
        initial={{ scale: 1 }}
        animate={{ scale: [1, 1.04, 1] }}
        transition={{ duration: 5.2, repeat: Infinity, ease: "easeInOut", delay: 0.4 }}
      >
        <img
          alt="Child reading the Healing to the Nations Magazine"
          className="absolute inset-0 max-w-none object-50%-50% object-cover pointer-events-none size-full"
          src={imgNewFrame}
        />
      </motion.div>
    </div>
  );
}

function Frame1() {
  return (
    <div className="basis-0 grow h-[445px] min-h-px min-w-px overflow-clip relative shrink-0">
      <motion.div 
        className="absolute h-[495px] left-[-80px] top-[-25px] w-[743px]" 
        data-name="_H3A2447"
        initial={{ scale: 1 }}
        animate={{ scale: [1, 1.05, 1] }}
        transition={{ duration: 5.5, repeat: Infinity, ease: "easeInOut", delay: 0.6 }}
      >
        <img alt="Pastor Chris ministering" className="absolute inset-0 max-w-none object-50%-50% object-contain pointer-events-none size-full" src={imgH3A2447} />
      </motion.div>
    </div>
  );
}

function Frame3() {
  return (
    <div className="absolute content-stretch flex gap-[24px] h-[445px] items-center left-[calc(50%-0.5px)] top-[1206px] translate-x-[-50%] w-[1442px]">
      <Frame />
      <FrameNew />
      <Frame1 />
    </div>
  );
}

function Frame4() {
  return (
    <div className="h-[445px] overflow-clip relative shrink-0 w-[1442px]">
      <motion.div 
        className="absolute h-[445px] left-0 top-0 w-[1442px]" 
        data-name="image 5"
        initial={{ scale: 1 }}
        animate={{ scale: [1, 1.04, 1] }}
        transition={{ duration: 6, repeat: Infinity, ease: "easeInOut" }}
      >
        <div className="absolute inset-0 overflow-hidden pointer-events-none">
          <img alt="Children group photo" className="absolute h-[182.47%] left-[-0.05%] max-w-none top-[-34.38%] w-[100.11%]" src={imgImage5} />
        </div>
      </motion.div>
    </div>
  );
}

function Frame2() {
  return (
    <div className="absolute content-stretch flex gap-[24px] items-center left-[calc(50%-0.5px)] top-[210px] translate-x-[-50%] w-[1442px]">
      <Frame4 />
    </div>
  );
}

function Pagination() {
  return (
    <div className="absolute bg-[red] box-border content-stretch flex gap-[6.087px] h-[42px] items-center justify-center left-[calc(50%-0.587px)] p-[6.087px] rounded-[60.87px] top-[2385px] translate-x-[-50%] w-[43.826px]" data-name="Pagination">
      <p className="font-['Comic_Sans_MS:Bold',sans-serif] leading-[29.318px] not-italic relative shrink-0 text-[25.653px] text-center text-nowrap text-white whitespace-pre">09</p>
    </div>
  );
}

export default function Page9() {
  const [isPlaying, setIsPlaying] = useState(false);
  const narrationAudioRef = useRef<HTMLAudioElement | null>(null);

  useEffect(() => {
    const audio = narrationAudioRef.current;
    if (!audio) return;

    const handleEnded = () => setIsPlaying(false);
    audio.addEventListener('ended', handleEnded);

    const timer = window.setTimeout(async () => {
      try {
        await audio.play();
        setIsPlaying(true);
      } catch (err) {
        console.warn('Page 9 narration auto-play blocked', err);
      }
    }, 1500);

    return () => {
      window.clearTimeout(timer);
      audio.removeEventListener('ended', handleEnded);
      audio.pause();
      audio.currentTime = 0;
    };
  }, []);

  const toggleAudio = async () => {
    const audio = narrationAudioRef.current;
    if (!audio) return;

    if (!audio.paused && isPlaying) {
      audio.pause();
      setIsPlaying(false);
      return;
    }

    try {
      await audio.play();
      setIsPlaying(true);
    } catch (err) {
      console.warn('Unable to play Page 9 narration', err);
    }
  };

  return (
    <>
      <audio ref={narrationAudioRef} src={narrationAudio} preload="auto" />
      {/* Main Page Content */}
      <div className="bg-white relative size-full" data-name="9">
        <div className="absolute h-[2480px] left-0 top-0 w-[1755px]" data-name="BG">
          <div className="absolute inset-0 overflow-hidden pointer-events-none">
            <img alt="" className="absolute h-[331.49%] left-[-167.23%] max-w-none top-[-43.47%] w-[334.58%]" src={imgBg} />
          </div>
        </div>
        <Footer />
        <ImgGroup1 />
        <div className="absolute h-[532px] left-[151px] top-[655px] w-[1423px]" data-name="image 34">
          <div className="absolute inset-0 overflow-hidden pointer-events-none">
            <img alt="Text content about results and God's word" className="absolute h-[223.21%] left-[-10.61%] max-w-none top-[-123.12%] w-[110.61%]" src={imgImage34} />
          </div>
        </div>
        <ImgGroup2 />
        <Frame3 />
        <Frame2 />
        <Pagination />
      </div>

      {/* Voiceover Control Button - Outside Magazine Container */}
      <motion.button
        onClick={toggleAudio}
        className="fixed bottom-32 right-8 z-50 pointer-events-auto bg-gradient-to-br from-purple-600 to-pink-600 text-white p-6 rounded-full shadow-2xl hover:scale-110 transition-transform border-4 border-white"
        initial={{ opacity: 0, scale: 0 }}
        animate={{ opacity: 1, scale: 1 }}
        transition={{ duration: 0.5, delay: 1.5 }}
        whileHover={{ scale: 1.15 }}
        whileTap={{ scale: 0.95 }}
        title={isPlaying ? "Stop voiceover" : "Play voiceover"}
      >
        {isPlaying ? (
          <VolumeX className="w-10 h-10" />
        ) : (
          <Volume2 className="w-10 h-10" />
        )}
      </motion.button>
    </>
  );
}
